"""
Common defines and item formatting for CSI Alerts
"""
from datetime import datetime
import json

# instance records

DOMAIN = 6
DBID = 5
APPNAME = 4
APPID = 3
RKEY = 2
LKEY = 1
ACCTNAME = 0
# issue records
ISTATUS = 0
ITYPE = 1
ISUBTYPE = 2
INOTES = 3
IVENDOR = 4
IVENDID = 5
IVPHONE = 6
IROLENAME = 7
IRID = 8
IRETAILER = 9
ISITEID = 10
ISITENAME = 11
IADDR1 = 12
ICITY = 13
ISTATE = 14
IZIP = 15
ICONTACTINFO = 16
IKEYACCOUNT = 17
IRUNID = 18
ISITYPEID = 19
ISITYPE = 20
IREASONID = 21
IREASON = 22
IMFGID = 23
IMFGNAME = 24
IRRID = 25
IRRNAME = 26
IWOID = 27
IWEBDIR = 28
IPREFIX = 29
IFNAME = 30
IEXT = 31
ISTART = 32
ISTORECI = 33

def format_item(conf, rec, runid):
    # data transforms
    dtm = rec[ISTART]
    dte = f'{dtm.month:02}{dtm.day:02}{dtm.year}{dtm.hour:02}{dtm.minute:02}'
    nts = rec[INOTES].split('.')
    storeci = json.loads(rec[ISTORECI])

    return {
            "id": f"{conf['rec'][APPID]}-{rec[IWOID]}-{dte}",
            "created_at": dtm.isoformat(),
            "runid": rec[IRUNID],
            "notes": rec[INOTES],
            "status": rec[ISTATUS],
            "type": {
                "id": rec[ISITYPEID],
                "text": rec[ISITYPE]
            },
            "reason": {
                "id": rec[IREASONID],
                "text": rec[IREASON]
            },
            "store": {
                "id": rec[ISITEID],
                "name": rec[ISITENAME],
                "address": rec[IADDR1],
                "city": rec[ICITY],
                "state": rec[ISTATE],
                "zip": rec[IZIP],
                "phone": rec[ICONTACTINFO]
                },
            "storecontact": {
                    "name": storeci["name"],
                    "roleid": storeci["roleid"],
                    "role": storeci["role"],
                    "phone": storeci["phone"],
                    "email": storeci["email"]
                    },
            "banner": {
                "id": rec[IRID],
                "name": rec[IRETAILER]
            },
            "retailer": {
                "id": rec[IRRID],
                "name": rec[IRRNAME]
            },
            "vendor": {
                "id": rec[IVENDID],
                "name": rec[IVENDOR],
                "number": rec[IVPHONE]
            },
            "manufacturer": {
                "id": rec[IMFGID],
                "name": rec[IMFGNAME]
            },
            "photos": []
        }